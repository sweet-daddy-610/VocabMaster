(function(){"use strict";var J=document.createElement("style");J.textContent=`:root{--bg-primary: #0a0e1a;--bg-secondary: #111827;--bg-card: rgba(17, 24, 39, .7);--bg-glass: rgba(255, 255, 255, .04);--bg-glass-hover: rgba(255, 255, 255, .08);--border-glass: rgba(255, 255, 255, .08);--border-glass-hover: rgba(255, 255, 255, .15);--accent-primary: #6366f1;--accent-primary-light: #818cf8;--accent-primary-glow: rgba(99, 102, 241, .3);--accent-secondary: #8b5cf6;--accent-green: #10b981;--accent-green-glow: rgba(16, 185, 129, .3);--accent-red: #ef4444;--accent-red-glow: rgba(239, 68, 68, .3);--accent-amber: #f59e0b;--accent-cyan: #06b6d4;--gradient-primary: linear-gradient(135deg, #6366f1, #8b5cf6);--gradient-success: linear-gradient(135deg, #10b981, #06b6d4);--gradient-danger: linear-gradient(135deg, #ef4444, #f97316);--gradient-warm: linear-gradient(135deg, #f59e0b, #ef4444);--gradient-bg: linear-gradient(180deg, #0a0e1a 0%, #111827 50%, #0f172a 100%);--text-primary: #f1f5f9;--text-secondary: #94a3b8;--text-muted: #64748b;--text-accent: #a5b4fc;--font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;--font-size-xs: .7rem;--font-size-sm: .8rem;--font-size-base: .95rem;--font-size-lg: 1.15rem;--font-size-xl: 1.4rem;--font-size-2xl: 1.8rem;--font-size-3xl: 2.4rem;--space-xs: 4px;--space-sm: 8px;--space-md: 16px;--space-lg: 24px;--space-xl: 32px;--space-2xl: 48px;--radius-sm: 8px;--radius-md: 12px;--radius-lg: 16px;--radius-xl: 20px;--radius-full: 50%;--shadow-sm: 0 1px 3px rgba(0, 0, 0, .3);--shadow-md: 0 4px 12px rgba(0, 0, 0, .4);--shadow-lg: 0 8px 32px rgba(0, 0, 0, .5);--shadow-glow: 0 0 20px var(--accent-primary-glow);--transition-fast: .15s ease;--transition-base: .25s ease;--transition-slow: .4s cubic-bezier(.22, 1, .36, 1)}*,*:before,*:after{margin:0;padding:0;box-sizing:border-box}html{font-size:16px;scroll-behavior:smooth;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-family);background:var(--gradient-bg);color:var(--text-primary);min-height:100vh;overflow-x:hidden;line-height:1.6}body:before{content:"";position:fixed;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 20% 20%,rgba(99,102,241,.08) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(139,92,246,.06) 0%,transparent 50%),radial-gradient(circle at 50% 50%,rgba(6,182,212,.04) 0%,transparent 50%);z-index:-1;animation:ambientShift 20s ease-in-out infinite}@keyframes ambientShift{0%,to{transform:translate(0) rotate(0)}33%{transform:translate(-2%,1%) rotate(1deg)}66%{transform:translate(1%,-2%) rotate(-1deg)}}input,button,select,textarea{font-family:inherit;font-size:inherit;color:inherit;border:none;outline:none;background:none}button{cursor:pointer}a{color:var(--accent-primary-light);text-decoration:none}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-glass);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--border-glass-hover)}.app-header{position:sticky;top:0;z-index:100;height:38px;background:#0a0e1ad9;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border-glass);-webkit-app-region:drag;flex-shrink:0}.content-stats{display:flex;gap:var(--space-md);justify-content:center;margin-bottom:var(--space-md);-webkit-app-region:no-drag}.logo{display:flex;align-items:center;gap:var(--space-sm)}.logo-icon{font-size:1.5rem}.logo h1{font-size:var(--font-size-lg);font-weight:700;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-.02em}.header-stats{display:flex;gap:var(--space-md)}.stat-badge{display:flex;flex-direction:column;align-items:center;padding:var(--space-xs) var(--space-md);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-sm);transition:var(--transition-base)}.stat-badge:hover{background:var(--bg-glass-hover);border-color:var(--border-glass-hover)}.review-badge .stat-number{color:var(--accent-green)}.stat-number{font-size:var(--font-size-lg);font-weight:700;color:var(--accent-primary-light);line-height:1.2}.stat-label{font-size:var(--font-size-xs);color:var(--text-muted);letter-spacing:.03em}.app-main{max-width:720px;margin:0 auto;padding:var(--space-lg);padding-bottom:100px;min-height:calc(100vh - 60px)}.page{display:none}.page.active{display:block;animation:fadeIn .3s ease}@keyframes fadeIn{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:100;background:#0a0e1ae6;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:1px solid var(--border-glass);display:flex;justify-content:center;gap:0;padding:var(--space-sm) 0;padding-bottom:max(var(--space-sm),env(safe-area-inset-bottom))}.nav-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:var(--space-sm) var(--space-xl);color:var(--text-muted);font-size:var(--font-size-xs);font-weight:500;transition:var(--transition-base);position:relative;border-radius:var(--radius-sm)}.nav-btn svg{width:22px;height:22px;transition:var(--transition-base)}.nav-btn.active{color:var(--accent-primary-light)}.nav-btn.active svg{filter:drop-shadow(0 0 6px var(--accent-primary-glow))}.nav-btn:hover{color:var(--text-secondary)}.nav-badge{position:absolute;top:2px;right:20px;min-width:18px;height:18px;padding:0 5px;background:var(--accent-red);color:#fff;font-size:10px;font-weight:700;border-radius:9px;display:flex;align-items:center;justify-content:center;animation:badgePulse 2s ease-in-out infinite}@keyframes badgePulse{0%,to{transform:scale(1)}50%{transform:scale(1.1)}}.toast-container{position:fixed;top:80px;right:20px;z-index:1000;display:flex;flex-direction:column;gap:var(--space-sm)}.toast{padding:var(--space-md) var(--space-lg);background:var(--bg-card);border:1px solid var(--border-glass);border-radius:var(--radius-md);-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);color:var(--text-primary);font-size:var(--font-size-sm);box-shadow:var(--shadow-lg);animation:toastIn .4s var(--transition-slow);max-width:320px}.toast.toast-success{border-left:3px solid var(--accent-green)}.toast.toast-error{border-left:3px solid var(--accent-red)}.toast.toast-info{border-left:3px solid var(--accent-primary)}.toast.toast-out{animation:toastOut .3s ease forwards}@keyframes toastIn{0%{opacity:0;transform:translate(40px)}to{opacity:1;transform:translate(0)}}@keyframes toastOut{0%{opacity:1;transform:translate(0)}to{opacity:0;transform:translate(40px)}}.hidden{display:none!important}@media(max-width:640px){.app-main{padding:var(--space-md);padding-bottom:100px}.header-content{padding:0 var(--space-sm)}.nav-btn{padding:var(--space-sm) var(--space-lg)}}.search-container{margin-bottom:var(--space-xl)}.search-box{display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-md) var(--space-lg);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-lg);transition:var(--transition-base);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.search-box:focus-within{border-color:var(--accent-primary);box-shadow:var(--shadow-glow);background:var(--bg-glass-hover)}.search-icon{width:20px;height:20px;color:var(--text-muted);flex-shrink:0}.search-box input{flex:1;font-size:var(--font-size-base);color:var(--text-primary);background:transparent}.search-box input::placeholder{color:var(--text-muted)}.search-btn{padding:var(--space-sm) var(--space-lg);background:var(--gradient-primary);color:#fff;font-weight:600;font-size:var(--font-size-sm);border-radius:var(--radius-sm);transition:var(--transition-base);white-space:nowrap}.search-btn:hover{transform:translateY(-1px);box-shadow:var(--shadow-glow)}.search-btn:active{transform:translateY(0)}.welcome-state{text-align:center;padding:var(--space-2xl) 0}.welcome-illustration{margin-bottom:var(--space-lg)}.welcome-emoji{font-size:4rem;display:inline-block;animation:float 3s ease-in-out infinite}@keyframes float{0%,to{transform:translateY(0)}50%{transform:translateY(-12px)}}.welcome-state h2{font-size:var(--font-size-xl);font-weight:700;margin-bottom:var(--space-sm);background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.welcome-state p{color:var(--text-secondary);font-size:var(--font-size-sm)}.quick-words{display:flex;flex-wrap:wrap;justify-content:center;gap:var(--space-sm);margin-top:var(--space-lg)}.quick-word{padding:var(--space-sm) var(--space-md);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-xl);color:var(--text-accent);font-size:var(--font-size-sm);font-weight:500;cursor:pointer;transition:var(--transition-base);font-style:italic}.quick-word:hover{background:var(--bg-glass-hover);border-color:var(--accent-primary);transform:translateY(-2px);box-shadow:var(--shadow-glow)}.loading-state{text-align:center;padding:var(--space-2xl) 0}.loading-spinner{width:40px;height:40px;border:3px solid var(--border-glass);border-top-color:var(--accent-primary);border-radius:50%;margin:0 auto var(--space-md);animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.loading-state p{color:var(--text-secondary);font-size:var(--font-size-sm)}.error-state{text-align:center;padding:var(--space-2xl) 0}.error-emoji{font-size:3rem;display:block;margin-bottom:var(--space-md)}.error-state h3{font-size:var(--font-size-lg);font-weight:600;margin-bottom:var(--space-xs)}.error-state p{color:var(--text-secondary);font-size:var(--font-size-sm)}.word-header{margin-bottom:var(--space-lg)}.word-title-row{display:flex;align-items:center;gap:var(--space-md);margin-bottom:var(--space-xs)}.word-title{font-size:var(--font-size-3xl);font-weight:800;letter-spacing:-.03em;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.sound-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-full);color:var(--text-secondary);transition:var(--transition-base)}.sound-btn svg{width:18px;height:18px}.sound-btn:hover{background:var(--accent-primary);color:#fff;border-color:var(--accent-primary);box-shadow:var(--shadow-glow)}.sound-btn:active{transform:scale(.95)}.saved-indicator{font-size:var(--font-size-xs);color:var(--accent-green);font-weight:600;padding:var(--space-xs) var(--space-sm);background:#10b9811a;border:1px solid rgba(16,185,129,.2);border-radius:var(--radius-sm);animation:fadeIn .3s ease}.word-phonetic{font-size:var(--font-size-base);color:var(--text-muted);font-style:italic}.translation-card{padding:var(--space-lg);background:linear-gradient(135deg,#6366f114,#8b5cf60d);border:1px solid rgba(99,102,241,.15);border-radius:var(--radius-lg);margin-bottom:var(--space-lg);position:relative;overflow:hidden}.translation-card:before{content:"";position:absolute;top:0;left:0;width:4px;height:100%;background:var(--gradient-primary);border-radius:2px}.translation-card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-sm)}.translation-card-header .card-label{margin-bottom:0}.card-label{font-size:var(--font-size-xs);font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--accent-primary-light);margin-bottom:var(--space-sm)}.retranslate-btn{display:flex;align-items:center;gap:4px;padding:3px var(--space-sm);background:#6366f114;border:1px solid rgba(99,102,241,.22);border-radius:var(--radius-xl);color:var(--accent-primary-light);font-size:var(--font-size-xs);font-weight:500;cursor:pointer;transition:var(--transition-base);white-space:nowrap;flex-shrink:0}.retranslate-btn svg{width:12px;height:12px;flex-shrink:0}.retranslate-btn:hover{background:#6366f12e;border-color:var(--accent-primary);box-shadow:var(--shadow-glow);transform:translateY(-1px)}.retranslate-btn:active{transform:translateY(0)}.retranslate-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}.retranslate-btn.loading svg{animation:spin .8s linear infinite}.translation-content{font-size:var(--font-size-lg);font-weight:500;color:var(--text-primary);line-height:1.8}.definition-group{margin-bottom:var(--space-lg);padding:var(--space-lg);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-lg);transition:var(--transition-base)}.definition-group:hover{border-color:var(--border-glass-hover)}.part-of-speech{display:inline-block;padding:2px var(--space-sm);background:var(--gradient-primary);color:#fff;font-size:var(--font-size-xs);font-weight:600;border-radius:var(--radius-sm);text-transform:uppercase;letter-spacing:.05em;margin-bottom:var(--space-md)}.definition-item{margin-bottom:var(--space-md);padding-left:var(--space-md);border-left:2px solid var(--border-glass)}.definition-item:last-child{margin-bottom:0}.definition-text{font-size:var(--font-size-base);color:var(--text-primary);margin-bottom:var(--space-xs);line-height:1.7}.definition-example{font-size:var(--font-size-sm);color:var(--text-muted);font-style:italic;padding-left:var(--space-md);border-left:2px solid var(--accent-primary-glow);margin-top:var(--space-xs)}.synonyms-row{display:flex;flex-wrap:wrap;gap:var(--space-xs);margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--border-glass)}.synonyms-label{font-size:var(--font-size-xs);color:var(--text-muted);font-weight:600;margin-right:var(--space-xs);line-height:26px}.synonym-tag{padding:2px var(--space-sm);background:#06b6d41a;border:1px solid rgba(6,182,212,.2);color:var(--accent-cyan);font-size:var(--font-size-xs);border-radius:var(--radius-xl);cursor:pointer;transition:var(--transition-base)}.synonym-tag:hover{background:#06b6d433;transform:translateY(-1px)}.input-type-badges{display:flex;gap:var(--space-xs);margin-top:var(--space-sm);flex-wrap:wrap}.input-type-badge{display:inline-block;padding:2px var(--space-sm);font-size:var(--font-size-xs);font-weight:600;border-radius:var(--radius-sm);letter-spacing:.03em}.phrase-badge{background:#f59e0b1f;border:1px solid rgba(245,158,11,.25);color:#f59e0b}.chinese-badge{background:#ef44441a;border:1px solid rgba(239,68,68,.22);color:#ef4444}.translation-badge{background:#6366f11a;border:1px solid rgba(99,102,241,.22);color:var(--accent-primary-light)}.wiktionary-badge{background:#06b6d41a;border:1px solid rgba(6,182,212,.22);color:var(--accent-cyan)}.no-definitions-msg{text-align:center;padding:var(--space-xl) var(--space-lg);background:var(--bg-glass);border:1px dashed var(--border-glass);border-radius:var(--radius-lg)}.no-def-text{font-size:var(--font-size-base);color:var(--text-secondary);margin-bottom:var(--space-xs)}.no-def-hint{font-size:var(--font-size-sm);color:var(--text-muted)}.extras-section{display:flex;flex-direction:column;gap:var(--space-sm);margin-top:var(--space-md)}.extra-panel{background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-lg);overflow:hidden;transition:border-color .2s ease}.extra-panel:hover{border-color:var(--border-glass-hover)}.extra-panel.expanded{border-color:#6366f140}.extra-panel-header{display:flex;align-items:center;justify-content:space-between;padding:var(--space-md) var(--space-lg);cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .15s ease}.extra-panel-header:hover{background:var(--bg-glass-hover)}.extra-panel-title{font-size:var(--font-size-sm);font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.08em}.extra-panel.expanded .extra-panel-title{color:var(--accent-primary-light)}.extra-panel-arrow{width:16px;height:16px;color:var(--text-muted);transition:transform .25s ease,color .15s ease;flex-shrink:0}.extra-panel.expanded .extra-panel-arrow{transform:rotate(180deg);color:var(--accent-primary-light)}.extra-panel-body{max-height:0;overflow:hidden;transition:max-height .3s ease}.extra-panel.expanded .extra-panel-body{max-height:500px}.extra-panel-loading{display:flex;align-items:center;gap:var(--space-sm);color:var(--text-muted);font-size:var(--font-size-sm);padding:var(--space-md) var(--space-lg) var(--space-lg)}.extra-loading-spinner{width:16px;height:16px;border:2px solid var(--border-glass);border-top-color:var(--accent-primary);border-radius:50%;animation:spin .8s linear infinite;flex-shrink:0}.extra-panel-error,.extra-panel-empty{font-size:var(--font-size-sm);color:var(--text-muted);padding:var(--space-sm) var(--space-lg) var(--space-lg);font-style:italic}.extra-panel-error{color:var(--accent-red);opacity:.8}.extra-panel-content{padding:var(--space-sm) var(--space-lg) var(--space-lg)}.extra-core-verb{font-size:var(--font-size-sm);color:var(--text-secondary);margin-bottom:var(--space-sm)}.extra-core-verb strong{color:var(--accent-primary-light)}.conjugation-table{width:100%;border-collapse:collapse}.conjugation-table tbody tr{border-bottom:1px solid var(--border-glass)}.conjugation-table tbody tr:last-child{border-bottom:none}.conj-label{font-size:var(--font-size-xs);color:var(--text-muted);padding:6px var(--space-md) 6px 0;white-space:nowrap;width:55%}.conj-value{font-size:var(--font-size-base);color:var(--text-primary);font-weight:500;padding:6px 0}.extra-word-list{display:flex;flex-direction:column;gap:var(--space-xs);padding:var(--space-sm) var(--space-lg) var(--space-lg)}.extra-word-item{display:flex;align-items:baseline;gap:var(--space-sm)}.extra-word-tag{font-size:var(--font-size-sm);font-weight:600;color:var(--accent-cyan);cursor:pointer;padding:2px var(--space-sm);background:#06b6d414;border:1px solid rgba(6,182,212,.18);border-radius:var(--radius-xl);transition:var(--transition-base);white-space:nowrap;flex-shrink:0}.extra-word-tag:hover{background:#06b6d42e;transform:translateY(-1px)}.extra-word-explanation{font-size:var(--font-size-sm);color:var(--text-secondary);line-height:1.5}.review-header{text-align:center;margin-bottom:var(--space-xl)}.review-header h2{font-size:var(--font-size-2xl);font-weight:700;margin-bottom:var(--space-xs)}.review-subtitle{color:var(--text-secondary);font-size:var(--font-size-sm)}.no-review-state{text-align:center;padding:var(--space-2xl) 0}.no-review-illustration{margin-bottom:var(--space-lg)}.celebrate-emoji{font-size:4rem;display:inline-block;animation:celebrate 1s ease-in-out}@keyframes celebrate{0%{transform:scale(.5) rotate(-10deg);opacity:0}50%{transform:scale(1.2) rotate(5deg)}to{transform:scale(1) rotate(0);opacity:1}}.no-review-state h3{font-size:var(--font-size-xl);font-weight:600;margin-bottom:var(--space-sm)}.no-review-state p{color:var(--text-secondary);font-size:var(--font-size-sm)}.next-review-info{margin-top:var(--space-lg);padding:var(--space-md) var(--space-lg);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-md);color:var(--text-secondary);font-size:var(--font-size-sm);display:inline-block}.review-progress{display:flex;align-items:center;gap:var(--space-md);margin-bottom:var(--space-xl)}.progress-bar{flex:1;height:6px;background:var(--bg-glass);border-radius:3px;overflow:hidden}.progress-fill{height:100%;background:var(--gradient-primary);border-radius:3px;transition:width .5s cubic-bezier(.22,1,.36,1);box-shadow:0 0 8px var(--accent-primary-glow);width:0%}.progress-text{font-size:var(--font-size-sm);color:var(--text-muted);font-weight:600;white-space:nowrap}.flashcard{perspective:1000px;margin-bottom:var(--space-xl);cursor:pointer}.flashcard-inner{position:relative;width:100%;min-height:300px;transition:transform .6s cubic-bezier(.22,1,.36,1);transform-style:preserve-3d}.flashcard-inner.flipped{transform:rotateY(180deg)}.flashcard-front,.flashcard-back{position:absolute;width:100%;min-height:300px;backface-visibility:hidden;-webkit-backface-visibility:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--space-xl);border-radius:var(--radius-xl);text-align:center}.flashcard-front{background:linear-gradient(135deg,#6366f11a,#8b5cf60d);border:1px solid rgba(99,102,241,.2);box-shadow:0 8px 40px #6366f11a}.flashcard-back{background:linear-gradient(135deg,#10b9811a,#06b6d40d);border:1px solid rgba(16,185,129,.2);box-shadow:0 8px 40px #10b9811a;transform:rotateY(180deg)}.flashcard-word{font-size:var(--font-size-3xl);font-weight:800;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:var(--space-sm);letter-spacing:-.02em}.flashcard-phonetic{font-size:var(--font-size-base);color:var(--text-muted);font-style:italic;margin-bottom:var(--space-md)}.flashcard-sound-btn{width:44px;height:44px;display:flex;align-items:center;justify-content:center;background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-full);color:var(--text-secondary);transition:var(--transition-base);margin-bottom:var(--space-md)}.flashcard-sound-btn svg{width:20px;height:20px}.flashcard-sound-btn:hover{background:var(--accent-primary);color:#fff;border-color:var(--accent-primary)}.flashcard-hint{font-size:var(--font-size-xs);color:var(--text-muted);margin-top:auto}.flashcard-back-word{font-size:var(--font-size-xl);font-weight:700;color:var(--text-primary);margin-bottom:var(--space-md)}.flashcard-translation{font-size:var(--font-size-lg);color:var(--accent-green);font-weight:600;margin-bottom:var(--space-md);line-height:1.6}.flashcard-definition{font-size:var(--font-size-sm);color:var(--text-secondary);line-height:1.7;max-width:400px}.review-actions{display:flex;gap:var(--space-md);justify-content:center;margin-bottom:var(--space-lg)}.review-btn{display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-md) var(--space-xl);border-radius:var(--radius-lg);font-weight:600;font-size:var(--font-size-base);transition:var(--transition-base);min-width:140px;justify-content:center}.btn-icon{font-size:var(--font-size-lg);font-weight:700}.forgot-btn{background:#ef44441a;border:1px solid rgba(239,68,68,.3);color:var(--accent-red)}.forgot-btn:hover{background:#ef444433;box-shadow:0 0 20px var(--accent-red-glow);transform:translateY(-2px)}.remembered-btn{background:#10b9811a;border:1px solid rgba(16,185,129,.3);color:var(--accent-green)}.remembered-btn:hover{background:#10b98133;box-shadow:0 0 20px var(--accent-green-glow);transform:translateY(-2px)}.review-btn:active{transform:translateY(0) scale(.98)}.review-level-info{text-align:center;font-size:var(--font-size-xs);color:var(--text-muted);padding:var(--space-sm) var(--space-md);background:var(--bg-glass);border-radius:var(--radius-sm)}.review-complete{text-align:center;padding:var(--space-2xl) 0}.complete-emoji{font-size:4rem;display:inline-block;margin-bottom:var(--space-lg);animation:celebrate .8s ease-in-out}.review-complete h3{font-size:var(--font-size-xl);font-weight:700;margin-bottom:var(--space-lg)}.review-summary{display:flex;justify-content:center;gap:var(--space-lg);margin-bottom:var(--space-xl)}.summary-item{padding:var(--space-md) var(--space-lg);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-md);text-align:center}.summary-value{font-size:var(--font-size-2xl);font-weight:700;display:block;margin-bottom:var(--space-xs)}.summary-value.green{color:var(--accent-green)}.summary-value.red{color:var(--accent-red)}.summary-label{font-size:var(--font-size-xs);color:var(--text-muted)}.restart-btn{padding:var(--space-md) var(--space-xl);background:var(--gradient-primary);color:#fff;font-weight:600;border-radius:var(--radius-lg);transition:var(--transition-base)}.restart-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-glow)}.history-header{margin-bottom:var(--space-lg)}.history-header h2{font-size:var(--font-size-2xl);font-weight:700;margin-bottom:var(--space-md)}.history-controls{display:flex;gap:var(--space-md);align-items:center}.history-search-box{flex:1;display:flex;align-items:center;gap:var(--space-sm);padding:var(--space-sm) var(--space-md);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-sm);transition:var(--transition-base)}.history-search-box:focus-within{border-color:var(--accent-primary);box-shadow:0 0 12px var(--accent-primary-glow)}.search-icon-small{width:16px;height:16px;color:var(--text-muted);flex-shrink:0}.history-search-box input{flex:1;font-size:var(--font-size-sm);color:var(--text-primary)}.history-search-box input::placeholder{color:var(--text-muted)}.history-sort{padding:var(--space-sm) var(--space-md);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-sm);color:var(--text-secondary);font-size:var(--font-size-sm);cursor:pointer;transition:var(--transition-base);-webkit-appearance:none;-moz-appearance:none;appearance:none;padding-right:var(--space-xl);background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%2394a3b8' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}.history-sort:focus{border-color:var(--accent-primary)}.history-sort option{background:var(--bg-secondary);color:var(--text-primary)}.history-stats{display:flex;gap:var(--space-md);margin-bottom:var(--space-lg);overflow-x:auto;padding-bottom:var(--space-xs)}.history-stat-card{flex:1;min-width:120px;padding:var(--space-md);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-md);text-align:center}.history-stat-value{font-size:var(--font-size-xl);font-weight:700;display:block;margin-bottom:2px}.history-stat-value.purple{color:var(--accent-primary-light)}.history-stat-value.green{color:var(--accent-green)}.history-stat-value.amber{color:var(--accent-amber)}.history-stat-value.cyan{color:var(--accent-cyan)}.history-stat-label{font-size:var(--font-size-xs);color:var(--text-muted)}.history-list{display:flex;flex-direction:column;gap:var(--space-sm)}.empty-history{text-align:center;padding:var(--space-2xl) 0}.empty-emoji{font-size:3rem;display:block;margin-bottom:var(--space-md)}.empty-history h3{font-size:var(--font-size-lg);font-weight:600;margin-bottom:var(--space-sm)}.empty-history p{color:var(--text-secondary);font-size:var(--font-size-sm)}.history-item{display:flex;align-items:center;gap:var(--space-md);padding:var(--space-md) var(--space-lg);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-md);transition:var(--transition-base);cursor:pointer}.history-item:hover{border-color:var(--border-glass-hover);background:var(--bg-glass-hover);transform:translate(4px)}.history-word-info{flex:1;min-width:0}.history-word{font-size:var(--font-size-base);font-weight:600;color:var(--text-primary);margin-bottom:2px}.history-translation{font-size:var(--font-size-sm);color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.history-meta{display:flex;flex-direction:column;align-items:flex-end;gap:var(--space-xs);flex-shrink:0}.history-date{font-size:var(--font-size-xs);color:var(--text-muted)}.level-badge{padding:2px var(--space-sm);border-radius:var(--radius-xl);font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em}.level-0{background:#ef444426;color:var(--accent-red);border:1px solid rgba(239,68,68,.3)}.level-1{background:#f59e0b26;color:var(--accent-amber);border:1px solid rgba(245,158,11,.3)}.level-2{background:#06b6d426;color:var(--accent-cyan);border:1px solid rgba(6,182,212,.3)}.level-3{background:#6366f126;color:var(--accent-primary-light);border:1px solid rgba(99,102,241,.3)}.level-4,.level-5{background:#10b98126;color:var(--accent-green);border:1px solid rgba(16,185,129,.3)}.level-6{background:linear-gradient(135deg,#10b98133,#06b6d433);color:var(--accent-green);border:1px solid rgba(16,185,129,.4)}.history-delete-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-full);color:var(--text-muted);transition:var(--transition-base);flex-shrink:0;opacity:0}.history-item:hover .history-delete-btn{opacity:1}.history-delete-btn:hover{background:#ef444426;color:var(--accent-red)}.history-delete-btn svg{width:16px;height:16px}.backup-actions{display:flex;gap:var(--space-sm);margin-bottom:var(--space-lg)}.backup-btn{display:flex;align-items:center;gap:var(--space-xs);padding:var(--space-sm) var(--space-md);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:var(--radius-sm);color:var(--text-secondary);font-size:var(--font-size-sm);font-weight:500;cursor:pointer;transition:var(--transition-base)}.backup-btn svg{width:16px;height:16px;flex-shrink:0}.backup-btn:hover{border-color:var(--accent-primary);color:var(--text-primary);background:var(--bg-glass-hover);transform:translateY(-1px);box-shadow:var(--shadow-glow)}.export-btn:hover{border-color:var(--accent-green);color:var(--accent-green);box-shadow:0 0 12px #10b98126}.import-btn:hover{border-color:var(--accent-cyan);color:var(--accent-cyan);box-shadow:0 0 12px #06b6d426}.backup-btn:active{transform:translateY(0)}@media(max-width:640px){.history-controls{flex-direction:column}.history-sort{width:100%}.history-stats{gap:var(--space-sm)}.history-stat-card{min-width:80px;padding:var(--space-sm)}.backup-actions{flex-direction:column}.backup-btn{justify-content:center}}.settings-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:#0009;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:1000;display:flex;align-items:center;justify-content:center;animation:fadeIn .2s ease}.settings-overlay.hidden{display:none}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.settings-modal{background:linear-gradient(145deg,#1a1a35,#12122a);border:1px solid rgba(255,255,255,.08);border-radius:20px;width:90%;max-width:380px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px #00000080;animation:slideUp .3s ease}@keyframes slideUp{0%{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}.settings-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 12px;border-bottom:1px solid rgba(255,255,255,.06)}.settings-header h2{font-size:1.2rem;font-weight:700;color:#e0e0ff;margin:0}.settings-close-btn{background:#ffffff0f;border:none;color:#88a;font-size:1.4rem;width:32px;height:32px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.settings-close-btn:hover{background:#ff505026;color:#f66}.settings-body{padding:20px 24px 24px}.settings-section h3{font-size:1rem;font-weight:600;color:#c0c0e0;margin:0 0 8px}.settings-desc{font-size:.82rem;color:#77a;line-height:1.5;margin:0 0 18px}.settings-field{margin-bottom:16px}.settings-field label{display:block;font-size:.85rem;font-weight:500;color:#99c;margin-bottom:8px}.api-key-input-row{display:flex;gap:6px}.api-key-input-row input{flex:1;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:10px 14px;font-size:.9rem;font-family:SF Mono,Fira Code,monospace;color:#e0e0ff;outline:none;transition:border-color .2s}.api-key-input-row input:focus{border-color:#648cff80}.api-key-input-row input::placeholder{color:#557}.settings-select{width:100%;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:10px 14px;font-size:.9rem;color:#e0e0ff;outline:none;cursor:pointer;-moz-appearance:none;appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%237777aa' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;transition:border-color .2s}.settings-select:focus{border-color:#648cff80}.settings-select option{background:#1a1a35;color:#e0e0ff}.toggle-visibility-btn{background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:10px;width:42px;color:#77a;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.toggle-visibility-btn:hover{background:#ffffff1a;color:#aad}.settings-hint{font-size:.78rem;color:#66a;margin:8px 0 0}.settings-hint a{color:#68f;text-decoration:none}.settings-hint a:hover{text-decoration:underline}.settings-actions{display:flex;gap:10px;margin-top:18px}.settings-btn{flex:1;padding:10px 16px;border:none;border-radius:10px;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s}.settings-btn.test-btn{background:#ffffff0f;color:#99c;border:1px solid rgba(255,255,255,.1)}.settings-btn.test-btn:hover{background:#ffffff1a;color:#bbe}.settings-btn.save-btn{background:linear-gradient(135deg,#46f,#64f);color:#fff}.settings-btn.save-btn:hover{background:linear-gradient(135deg,#57f,#75f);transform:translateY(-1px);box-shadow:0 4px 15px #4466ff4d}.api-key-status{margin-top:12px;padding:10px 14px;border-radius:10px;font-size:.85rem;animation:fadeIn .3s ease}.api-key-status.hidden{display:none}.api-key-status.success{background:#28c8781a;border:1px solid rgba(40,200,120,.2);color:#4c8}.api-key-status.error{background:#ff50501a;border:1px solid rgba(255,80,80,.2);color:#f66}.translation-source{display:inline-block;font-size:.7rem;font-weight:600;padding:2px 8px;border-radius:6px;margin-left:8px;vertical-align:middle}.translation-source.deepseek{background:linear-gradient(135deg,#4466ff26,#6644ff26);color:#89f;border:1px solid rgba(68,102,255,.2)}
/*$vite$:1*/`,document.head.appendChild(J);const ue="https://api.dictionaryapi.dev/api/v2/entries/en",fe="https://en.wiktionary.org/api/rest_v1/page/definition",ve="https://api.mymemory.translated.net/get";function j(e){const t=e.trim();return/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(t)?"chinese":/\s/.test(t)&&t.split(/\s+/).length>1?"phrase":"word"}async function M(e){try{const t=await fetch(`${ue}/${encodeURIComponent(e.trim().toLowerCase())}`);if(!t.ok){if(t.status===404)return null;throw new Error(`API error: ${t.status}`)}const a=await t.json();if(!Array.isArray(a)||a.length===0)return null;const r=a[0];return{word:r.word,phonetic:Le(r),audioUrl:Ae(r),meanings:Pe(r),source:"free-dictionary"}}catch(t){return console.error("Free Dictionary lookup error:",t),null}}async function W(e){try{const t=e.trim().toLowerCase().replace(/\s+/g,"_"),a=await fetch(`${fe}/${encodeURIComponent(t)}`);if(!a.ok){if(a.status===404)return null;throw new Error(`Wiktionary API error: ${a.status}`)}const r=await a.json();return be(e,r)}catch(t){return console.error("Wiktionary lookup error:",t),null}}function be(e,t){const a=t.en||t.English||[];if(!Array.isArray(a)||a.length===0){const r=Object.keys(t).find(n=>Array.isArray(t[n])&&t[n].length>0);return r?X(e,t[r]):null}return X(e,a)}function X(e,t){const a=[];for(const r of t){if(!r.definitions||r.definitions.length===0)continue;const n=r.definitions.slice(0,3).map(o=>{const s=Q(o.definition||""),i=(o.examples||[]).slice(0,2).map(c=>Q(c));return{definition:s,example:i.length>0?i[0]:null}}).filter(o=>o.definition);n.length>0&&a.push({partOfSpeech:r.partOfSpeech||"unknown",definitions:n,synonyms:[]})}return a.length===0?null:{word:e.trim().toLowerCase(),phonetic:"",audioUrl:null,meanings:a,source:"wiktionary"}}function Q(e){return e?e.replace(/<[^>]*>/g,"").trim():""}async function Z(e,t){try{const a=await fetch(`${ve}?q=${encodeURIComponent(e)}&langpair=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(`Translation API error: ${a.status}`);const r=await a.json();if(r.responseStatus===200&&r.responseData){const n=r.responseData.translatedText;if(n&&n.toLowerCase()!==e.toLowerCase())return n}return null}catch(a){return console.error("Translation error:",a),null}}async function ee(e){return await Z(e,"en|zh-CN")||"ç¿»è¯‘æš‚ä¸å¯ç”¨"}async function he(e){return await Z(e,"zh-CN|en")}async function xe(e){const t=j(e),a=e.trim();return t==="chinese"?await ke(a):t==="phrase"?await we(a):await ye(a)}async function ye(e){const[t,a]=await Promise.all([M(e),ee(e)]);if(t)return{dictData:t,translation:a,inputType:"word"};const r=await W(e);if(r)return{dictData:r,translation:a,inputType:"word"};if(a&&a!=="ç¿»è¯‘æš‚ä¸å¯ç”¨")return{dictData:z(e),translation:a,inputType:"word"};const n=await $(e);return n?{dictData:{...z(e),source:"deepseek"},translation:n,inputType:"word"}:{dictData:null,translation:a,inputType:"word"}}async function we(e){const[t,a]=await Promise.all([W(e),ee(e)]);if(t)return{dictData:t,translation:a,inputType:"phrase"};const r=await M(e);if(r)return{dictData:r,translation:a,inputType:"phrase"};if(a&&a!=="ç¿»è¯‘æš‚ä¸å¯ç”¨")return{dictData:z(e),translation:a,inputType:"phrase"};const n=await $(e);return n?{dictData:{...z(e),source:"deepseek"},translation:n,inputType:"phrase"}:{dictData:null,translation:a,inputType:"phrase"}}async function ke(e){let t=await he(e);if(t||(t=await $(e)),!t)return{dictData:z(e),translation:e,inputType:"chinese"};const a=t.toLowerCase().trim().replace(/[.!?,;:]+$/,"");let r=await M(a);return r||(r=await W(a)),{dictData:r?{...r,word:e,originalWord:r.word}:z(e),translation:t,inputType:"chinese"}}function z(e){return{word:e.trim().toLowerCase(),phonetic:"",audioUrl:null,meanings:[],source:"translation-only"}}const h={deepseek:{name:"DeepSeek",endpoint:"https://api.deepseek.com/chat/completions",model:"deepseek-chat"},gemini:{name:"Google Gemini",getEndpoint:e=>`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${e}`}},te="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šç¿»è¯‘åŠ©æ‰‹ã€‚è¯†åˆ«ç”¨æˆ·è¾“å…¥çš„è¯­ç§ï¼šå¦‚æœæ˜¯ä¸­æ–‡åˆ™ç¿»è¯‘æˆè‹±æ–‡ï¼Œå¦‚æœæ˜¯è‹±æ–‡æˆ–å…¶ä»–è¯­è¨€åˆ™ç¿»è¯‘æˆä¸­æ–‡ã€‚åªè¿”å›ç¿»è¯‘ç»“æœï¼Œä¸è¦ä»»ä½•è§£é‡Šã€æ ‡ç‚¹ä¿®æ”¹æˆ–é¢å¤–å†…å®¹ã€‚";async function $(e){const t=localStorage.getItem("llm-provider")||"deepseek",a=localStorage.getItem("llm-api-key");if(!a)return null;try{return t==="gemini"?await D(a,te,e):await O(h.deepseek.endpoint,a,h.deepseek.model,te,e)}catch(r){return console.error(`${t} translation error:`,r),null}}async function Ee(e,t=null){var r;t=t||localStorage.getItem("llm-provider")||"deepseek";const a=((r=h[t])==null?void 0:r.name)||t;try{let n;return t==="gemini"?n=await D(e,"Reply with OK","Hello"):n=await O(h.deepseek.endpoint,e,h.deepseek.model,"Reply with OK","Hello"),n?{success:!0,message:`âœ… è¿æ¥æˆåŠŸï¼${a} API å¯ç”¨ã€‚`}:{success:!1,message:`âŒ ${a} API è¿”å›ç©ºç»“æœã€‚`}}catch(n){const o=n.message||"";return o.includes("401")||o.includes("403")?{success:!1,message:"âŒ API Key æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚"}:{success:!1,message:`âŒ ${a} è¿æ¥å¤±è´¥: ${o}`}}}async function O(e,t,a,r,n){var i,c,d,p;const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:a,messages:[{role:"system",content:r},{role:"user",content:n}],temperature:.3,max_tokens:200})});if(!o.ok)throw new Error(`API error: ${o.status}`);return((p=(d=(c=(i=(await o.json()).choices)==null?void 0:i[0])==null?void 0:c.message)==null?void 0:d.content)==null?void 0:p.trim())||null}async function D(e,t,a){var s,i,c,d,p,l;const r=h.gemini.getEndpoint(e),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_instruction:{parts:[{text:t}]},contents:[{parts:[{text:a}]}],generationConfig:{temperature:.3,maxOutputTokens:200}})});if(!n.ok)throw new Error(`API error: ${n.status}`);return((l=(p=(d=(c=(i=(s=(await n.json()).candidates)==null?void 0:s[0])==null?void 0:i.content)==null?void 0:c.parts)==null?void 0:d[0])==null?void 0:p.text)==null?void 0:l.trim())||null}function ae(e,t="en-US",a=null){if(a){new Audio(a).play().catch(n=>{console.warn("Audio playback failed, falling back to Google TTS:",n),re(e,t)});return}re(e,t)}function re(e,t){const r=`https://translate.google.com/translate_tts?ie=UTF-8&tl=${t==="zh-CN"?"zh-CN":"en"}&client=tw-ob&q=${encodeURIComponent(e)}`;new Audio(r).play().catch(o=>{console.warn("Google TTS failed, falling back to browser TTS:",o),Ie(e,t)})}function Ie(e,t){if(!("speechSynthesis"in window))return;window.speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(e);a.lang=t,a.rate=.9,a.pitch=1;const r=window.speechSynthesis.getVoices();if(r.length>0){const n=t.split("-")[0],o=r.find(s=>s.lang.startsWith(n)&&(s.name.includes("Premium")||s.name.includes("Enhanced")||s.name.includes("Natural")))||r.find(s=>s.lang.startsWith(n)&&s.localService)||r.find(s=>s.lang.startsWith(n));o&&(a.voice=o)}window.speechSynthesis.speak(a)}const ze=`ä½ æ˜¯è‹±è¯­è¯­æ³•ä¸“å®¶ã€‚åˆ†æè¾“å…¥çš„è‹±è¯­å•è¯æˆ–çŸ­è¯­ï¼Œæ‰¾å‡ºæ ¸å¿ƒåŠ¨è¯ï¼Œç»™å‡ºè¯¥åŠ¨è¯çš„å®Œæ•´æ—¶æ€å˜å½¢ã€‚
ä»…è¿”å›å¦‚ä¸‹JSONï¼ˆä¸å«ä»»ä½•å…¶ä»–å†…å®¹æˆ–ä»£ç å—æ ‡è®°ï¼‰ï¼š
{"coreVerb":"<æ ¸å¿ƒåŠ¨è¯åŸå½¢>","forms":{"base":"<åŸå½¢>","pastTense":"<è¿‡å»å¼>","pastParticiple":"<è¿‡å»åˆ†è¯>","presentParticiple":"<ç°åœ¨åˆ†è¯>","thirdPerson":"<ç¬¬ä¸‰äººç§°å•æ•°>"}}
è‹¥è¾“å…¥ä¸å«åŠ¨è¯ï¼ˆå¦‚çº¯åè¯/å½¢å®¹è¯ï¼‰ï¼Œè¿”å›ï¼š{"coreVerb":null,"forms":null}`,Ce=`ä½ æ˜¯è‹±è¯­è¯æ±‡ä¸“å®¶ã€‚ç»™å‡ºè¾“å…¥è‹±è¯­å•è¯æˆ–çŸ­è¯­çš„3-5ä¸ªè¿‘ä¹‰è¯ï¼Œæ¯ä¸ªé™„ä¸Šç®€çŸ­ä¸­æ–‡è§£é‡Šã€‚
ä»…è¿”å›å¦‚ä¸‹JSONæ•°ç»„ï¼ˆä¸å«ä»»ä½•å…¶ä»–å†…å®¹æˆ–ä»£ç å—æ ‡è®°ï¼‰ï¼š
[{"word":"<è¿‘ä¹‰è¯>","explanation":"<ä¸­æ–‡ç®€é‡Š>"}]`,Be=`ä½ æ˜¯è‹±è¯­è¯æ±‡ä¸“å®¶ã€‚ç»™å‡ºè¾“å…¥è‹±è¯­å•è¯æˆ–çŸ­è¯­çš„3-5ä¸ªåä¹‰è¯ï¼Œæ¯ä¸ªé™„ä¸Šç®€çŸ­ä¸­æ–‡è§£é‡Šã€‚
ä»…è¿”å›å¦‚ä¸‹JSONæ•°ç»„ï¼ˆä¸å«ä»»ä½•å…¶ä»–å†…å®¹æˆ–ä»£ç å—æ ‡è®°ï¼‰ï¼š
[{"word":"<åä¹‰è¯>","explanation":"<ä¸­æ–‡ç®€é‡Š>"}]
è‹¥æ— æ˜æ˜¾åä¹‰è¯åˆ™è¿”å›ç©ºæ•°ç»„[]ã€‚`;async function Se(e,t){const a=localStorage.getItem("llm-provider")||"deepseek",r=localStorage.getItem("llm-api-key");if(!r)return null;const o={conjugations:ze,synonyms:Ce,antonyms:Be}[t];if(!o)return null;try{let s;if(a==="gemini"?s=await D(r,o,e):s=await O(h.deepseek.endpoint,r,h.deepseek.model,o,e),!s)return null;const i=s.replace(/^```(?:json)?\s*|\s*```$/g,"").trim();return JSON.parse(i)}catch(s){return console.error(`fetchWordExtras(${t}) error:`,s),null}}function Le(e){if(e.phonetic)return e.phonetic;if(e.phonetics&&e.phonetics.length>0){for(const t of e.phonetics)if(t.text)return t.text}return""}function Ae(e){if(e.phonetics&&e.phonetics.length>0){for(const t of e.phonetics)if(t.audio&&t.audio.length>0)return t.audio}return null}function Pe(e){return e.meanings?e.meanings.map(t=>({partOfSpeech:t.partOfSpeech||"unknown",definitions:(t.definitions||[]).slice(0,3).map(a=>({definition:a.definition,example:a.example||null})),synonyms:(t.synonyms||[]).slice(0,5)})):[]}const Te="VocabMasterDB",$e=1,m="words";let R=null;function x(){return R?Promise.resolve(R):new Promise((e,t)=>{const a=indexedDB.open(Te,$e);a.onerror=()=>t(a.error),a.onupgradeneeded=r=>{const n=r.target.result;if(!n.objectStoreNames.contains(m)){const o=n.createObjectStore(m,{keyPath:"word"});o.createIndex("addedAt","addedAt",{unique:!1}),o.createIndex("nextReviewAt","nextReviewAt",{unique:!1}),o.createIndex("level","level",{unique:!1})}},a.onsuccess=r=>{R=r.target.result,e(R)}})}async function Re(e){const t=await x();return new Promise((a,r)=>{const o=t.transaction(m,"readwrite").objectStore(m),s={word:e.word.toLowerCase(),phonetic:e.phonetic||"",audioUrl:e.audioUrl||null,meanings:e.meanings||[],translation:e.translation||"",addedAt:Date.now(),nextReviewAt:Date.now()+1440*60*1e3,reviewCount:0,level:0},i=o.put(s);i.onsuccess=()=>a(),i.onerror=()=>r(i.error)})}async function L(e){const t=await x();return new Promise((a,r)=>{const s=t.transaction(m,"readonly").objectStore(m).get(e.toLowerCase());s.onsuccess=()=>a(s.result||null),s.onerror=()=>r(s.error)})}async function C(){const e=await x();return new Promise((t,a)=>{const o=e.transaction(m,"readonly").objectStore(m).getAll();o.onsuccess=()=>t(o.result||[]),o.onerror=()=>a(o.error)})}async function U(e,t){const a=await x();return new Promise((r,n)=>{const s=a.transaction(m,"readwrite").objectStore(m),i=s.get(e.toLowerCase());i.onsuccess=()=>{const c=i.result;if(!c){r();return}const d={...c,...t},p=s.put(d);p.onsuccess=()=>r(),p.onerror=()=>n(p.error)},i.onerror=()=>n(i.error)})}async function Ne(e){const t=await x();return new Promise((a,r)=>{const s=t.transaction(m,"readwrite").objectStore(m).delete(e.toLowerCase());s.onsuccess=()=>a(),s.onerror=()=>r(s.error)})}async function je(){const e=await x();return new Promise((t,a)=>{const o=e.transaction(m,"readonly").objectStore(m).count();o.onsuccess=()=>t(o.result),o.onerror=()=>a(o.error)})}async function Me(){const e=await C();if(e.length===0)throw new Error("æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®");const t={version:1,exportedAt:new Date().toISOString(),wordCount:e.length,words:e},a=JSON.stringify(t,null,2),r=new Blob([a],{type:"application/json"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n;const s=new Date().toISOString().slice(0,10);return o.download=`vocabmaster_backup_${s}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),e.length}async function We(e){const t=await e.text();let a;try{a=JSON.parse(t)}catch{throw new Error("æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è§£æ JSON")}const r=Array.isArray(a)?a:a.words||[];if(!Array.isArray(r)||r.length===0)throw new Error("æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°è¯æ±‡æ•°æ®");let n=0,o=0;for(const s of r){if(!s.word)continue;if(await L(s.word)){o++;continue}const c=await x();await new Promise((d,p)=>{const u=c.transaction(m,"readwrite").objectStore(m).put({word:s.word.toLowerCase(),phonetic:s.phonetic||"",meanings:s.meanings||[],translation:s.translation||"",addedAt:s.addedAt||Date.now(),nextReviewAt:s.nextReviewAt||Date.now()+1440*60*1e3,reviewCount:s.reviewCount||0,level:s.level||0,lastReviewedAt:s.lastReviewedAt||null});u.onsuccess=()=>d(),u.onerror=()=>p(u.error)}),n++}return{imported:n,skipped:o}}const I=[1440*60*1e3,2880*60*1e3,5760*60*1e3,10080*60*1e3,360*60*60*1e3,720*60*60*1e3],N=["æ–°å•è¯","åˆšå­¦ä¹ ","åˆæ­¥æŒæ¡","åŸºæœ¬æŒæ¡","ç†Ÿç»ƒ","ç²¾é€š","å·²æŒæ¡"];function Oe(e){const t=Date.now();return e>=I.length?t+1440*60*60*1e3:t+I[e]}async function ne(){const e=await C(),t=Date.now();return e.filter(a=>a.nextReviewAt<=t&&a.level<I.length)}async function oe(){return(await ne()).length}async function De(e,t){const r=(await C()).find(s=>s.word===e.toLowerCase());if(!r)return null;let n;t?n=Math.min(r.level+1,I.length):n=0;const o={level:n,reviewCount:r.reviewCount+1,nextReviewAt:Oe(n),lastReviewedAt:Date.now()};return await U(e,o),{...r,...o}}async function Ue(){const e=await C(),t=Date.now(),a=e.filter(r=>r.nextReviewAt>t&&r.level<I.length);return a.length===0?null:Math.min(...a.map(r=>r.nextReviewAt))}async function He(){const e=await C(),t=Date.now(),a=e.length,r=e.filter(s=>s.level>=I.length).length,n=e.filter(s=>s.nextReviewAt<=t&&s.level<I.length).length,o=a-r;return{total:a,mastered:r,due:n,learning:o}}let H=null;async function qe(){return"Notification"in window?Notification.permission==="granted"?"granted":Notification.permission==="denied"?"denied":await Notification.requestPermission():(console.warn("Browser does not support notifications"),"denied")}function _e(e,t,a={}){if(Notification.permission!=="granted")return;const r=new Notification(e,{body:t,icon:"ğŸ“–",badge:"ğŸ“–",tag:"vocabmaster-review",renotify:!0,...a});r.onclick=()=>{window.focus();const n=new CustomEvent("navigate",{detail:"pageReview"});window.dispatchEvent(n),r.close()},setTimeout(()=>r.close(),1e4)}async function se(){try{const e=await oe();e>0&&_e("ğŸ“š å¤ä¹ æ—¶é—´åˆ°ï¼",`ä½ æœ‰ ${e} ä¸ªå•è¯éœ€è¦å¤ä¹ ï¼Œå¿«æ¥å·©å›ºè®°å¿†å§ï¼`)}catch(e){console.error("Notification check error:",e)}}function Ke(){H&&clearInterval(H),se(),H=setInterval(se,1800*1e3)}function q(e){document.querySelectorAll(".page").forEach(r=>r.classList.remove("active")),document.querySelectorAll(".nav-btn").forEach(r=>r.classList.remove("active"));const t=document.getElementById(e);t&&t.classList.add("active");const a=document.querySelector(`[data-page="${e}"]`);a&&a.classList.add("active")}function f(e,t="info",a=3e3){const r=document.getElementById("toastContainer"),n=document.createElement("div");n.className=`toast toast-${t}`,n.textContent=e,r.appendChild(n),setTimeout(()=>{n.classList.add("toast-out"),n.addEventListener("animationend",()=>n.remove())},a)}function _(e){["welcomeState","loadingState","errorState","resultState"].forEach(a=>{const r=document.getElementById(a);r&&r.classList.toggle("hidden",a!==`${e}State`)})}function ie(e,t,a,r="word"){_("result");const n=document.getElementById("retranslateBtn");n&&n.classList.remove("hidden"),document.getElementById("wordTitle").textContent=e.word,document.getElementById("wordPhonetic").textContent=e.phonetic||"",document.getElementById("savedIndicator").classList.toggle("hidden",!a);const i=document.getElementById("translationCard").querySelector(".card-label");if(r==="chinese"){i.textContent="è‹±æ–‡é‡Šä¹‰";let l=t;e.originalWord&&e.originalWord!==t.toLowerCase()&&(l=`${t}`),document.getElementById("translationContent").textContent=l}else i.textContent="ä¸­æ–‡é‡Šä¹‰",document.getElementById("translationContent").textContent=t;let c="";r==="phrase"?c='<span class="input-type-badge phrase-badge">çŸ­è¯­</span>':r==="chinese"&&(c='<span class="input-type-badge chinese-badge">ä¸­æ–‡æŸ¥è¯¢</span>'),e.source==="translation-only"?c+='<span class="input-type-badge translation-badge">ç¿»è¯‘æ¨¡å¼</span>':e.source==="wiktionary"?c+='<span class="input-type-badge wiktionary-badge">Wiktionary</span>':e.source==="deepseek"&&(c+='<span class="translation-source deepseek">DeepSeek AI</span>');let d=document.getElementById("inputTypeBadges");d||(d=document.createElement("div"),d.id="inputTypeBadges",d.className="input-type-badges",document.querySelector(".word-header").appendChild(d)),d.innerHTML=c;const p=document.getElementById("definitionsSection");if(p.innerHTML="",e.meanings&&e.meanings.length>0)e.meanings.forEach(l=>{const g=document.createElement("div");g.className="definition-group";const u=document.createElement("span");if(u.className="part-of-speech",u.textContent=l.partOfSpeech,g.appendChild(u),l.definitions.forEach(b=>{const k=document.createElement("div");k.className="definition-item";const S=document.createElement("p");if(S.className="definition-text",S.textContent=b.definition,k.appendChild(S),b.example){const E=document.createElement("p");E.className="definition-example",E.textContent=`"${b.example}"`,k.appendChild(E)}g.appendChild(k)}),l.synonyms&&l.synonyms.length>0){const b=document.createElement("div");b.className="synonyms-row";const k=document.createElement("span");k.className="synonyms-label",k.textContent="åŒä¹‰è¯:",b.appendChild(k),l.synonyms.forEach(S=>{const E=document.createElement("span");E.className="synonym-tag",E.textContent=S,E.addEventListener("click",()=>{const ut=new CustomEvent("lookupWord",{detail:S});window.dispatchEvent(ut)}),b.appendChild(E)}),g.appendChild(b)}p.appendChild(g)});else{const l=document.createElement("div");l.className="no-definitions-msg",l.innerHTML=`
            <p class="no-def-text">æš‚æ— è¯¦ç»†è‹±æ–‡é‡Šä¹‰</p>
            <p class="no-def-hint">å·²æä¾›ç¿»è¯‘ç»“æœï¼Œå¯æ”¶å½•åˆ°è¯æ±‡æœ¬ä¸­å­¦ä¹ </p>
        `,p.appendChild(l)}}function ce(e){_("error"),document.getElementById("errorMessage").textContent=e}function Ye(e){const t=document.getElementById("historyStats");t.innerHTML=`
    <div class="history-stat-card">
      <span class="history-stat-value purple">${e.total}</span>
      <span class="history-stat-label">æ€»è¯æ±‡</span>
    </div>
    <div class="history-stat-card">
      <span class="history-stat-value green">${e.mastered}</span>
      <span class="history-stat-label">å·²æŒæ¡</span>
    </div>
    <div class="history-stat-card">
      <span class="history-stat-value amber">${e.due}</span>
      <span class="history-stat-label">å¾…å¤ä¹ </span>
    </div>
    <div class="history-stat-card">
      <span class="history-stat-value cyan">${e.learning}</span>
      <span class="history-stat-label">å­¦ä¹ ä¸­</span>
    </div>
  `}function Fe(e,t,a){const r=document.getElementById("historyList"),n=document.getElementById("emptyHistory");if(e.length===0){r.innerHTML="",r.appendChild(n||rt());return}r.innerHTML="",e.forEach(o=>{const s=document.createElement("div");s.className="history-item",s.addEventListener("click",l=>{l.target.closest(".history-delete-btn")||a(o.word)});const i=`level-${Math.min(o.level,6)}`,c=N[Math.min(o.level,N.length-1)],d=at(o.addedAt);s.innerHTML=`
      <div class="history-word-info">
        <div class="history-word">${y(o.word)}</div>
        <div class="history-translation">${y(o.translation||"")}</div>
      </div>
      <div class="history-meta">
        <span class="history-date">${d}</span>
        <span class="level-badge ${i}">${c}</span>
      </div>
      <button class="history-delete-btn" title="åˆ é™¤" data-word="${y(o.word)}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18"></path>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
      </button>
    `,s.querySelector(".history-delete-btn").addEventListener("click",l=>{l.stopPropagation(),t(o.word),s.style.transform="translateX(100%)",s.style.opacity="0",s.style.transition="all 0.3s ease",setTimeout(()=>s.remove(),300)}),r.appendChild(s)})}function K(e){document.getElementById("noReviewState").classList.toggle("hidden",e!=="noReview"),document.getElementById("reviewCardContainer").classList.toggle("hidden",e!=="card"),document.getElementById("reviewComplete").classList.toggle("hidden",e!=="complete")}function le(e,t,a){document.getElementById("flashcardInner").classList.remove("flipped");const r=(t-1)/a*100;document.getElementById("reviewProgressFill").style.width=`${r}%`,document.getElementById("reviewProgressText").textContent=`${t} / ${a}`,document.getElementById("flashcardWord").textContent=e.word,document.getElementById("flashcardPhonetic").textContent=e.phonetic||"",document.getElementById("flashcardBackWord").textContent=e.word,document.getElementById("flashcardTranslation").textContent=e.translation||"";let n="";if(e.meanings&&e.meanings.length>0){const s=e.meanings[0];s.definitions&&s.definitions.length>0&&(n=`(${s.partOfSpeech}) ${s.definitions[0].definition}`)}document.getElementById("flashcardDefinition").textContent=n;const o=N[Math.min(e.level,N.length-1)];document.getElementById("reviewLevelInfo").textContent=`å½“å‰ç­‰çº§: ${o} Â· å·²å¤ä¹  ${e.reviewCount} æ¬¡`}function Ve(e,t){K("complete");const a=document.getElementById("reviewProgressFill");a.style.width="100%";const r=document.getElementById("reviewSummary");r.innerHTML=`
    <div class="summary-item">
      <span class="summary-value green">${e}</span>
      <span class="summary-label">è®°ä½äº†</span>
    </div>
    <div class="summary-item">
      <span class="summary-value red">${t}</span>
      <span class="summary-label">å¿˜è®°äº†</span>
    </div>
  `}function Ge(e){const t=document.getElementById("nextReviewInfo");if(!e){t.textContent="æ”¶å½•æ›´å¤šå•è¯åå°†è‡ªåŠ¨å®‰æ’å¤ä¹ ";return}const a=e-Date.now();if(a<=0){t.textContent="æœ‰å•è¯å·²ç»å¯ä»¥å¤ä¹ äº†ï¼";return}const r=Math.floor(a/(1e3*60*60)),n=Math.floor(a%(1e3*60*60)/(1e3*60));if(r>24){const o=Math.floor(r/24);t.textContent=`ä¸‹æ¬¡å¤ä¹ åœ¨ ${o} å¤©å`}else r>0?t.textContent=`ä¸‹æ¬¡å¤ä¹ åœ¨ ${r} å°æ—¶ ${n} åˆ†é’Ÿå`:t.textContent=`ä¸‹æ¬¡å¤ä¹ åœ¨ ${n} åˆ†é’Ÿå`}function Je(e,t){document.getElementById("totalWordsCount").textContent=e,document.getElementById("dueWordsCount").textContent=t;const a=document.getElementById("reviewBadge");t>0?(a.classList.remove("hidden"),a.textContent=t):a.classList.add("hidden")}const Xe=[{type:"conjugations",label:"æ—¶æ€å˜å½¢"},{type:"synonyms",label:"è¿‘ä¹‰è¯"},{type:"antonyms",label:"åä¹‰è¯"}];function de(){const e=document.getElementById("extrasSection");e&&e.remove();const t=document.getElementById("definitionsSection");if(!t)return{};const a=document.createElement("div");a.className="extras-section",a.id="extrasSection",t.after(a);const r={};for(const{type:n,label:o}of Xe){const s=document.createElement("div");s.className="extra-panel",s.id=`extra-panel-${n}`;const i=document.createElement("div");i.className="extra-panel-header",i.innerHTML=`
            <span class="extra-panel-title">${o}</span>
            <svg class="extra-panel-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        `;const c=document.createElement("div");c.className="extra-panel-body",s.appendChild(i),s.appendChild(c),a.appendChild(s),r[n]={panel:s,header:i,body:c}}return r}function Qe(e){e.innerHTML=`
        <div class="extra-panel-loading">
            <div class="extra-loading-spinner"></div>
            <span>æ­£åœ¨æŸ¥è¯¢...</span>
        </div>
    `}function Ze(e,t="æŸ¥è¯¢å¤±è´¥ï¼Œè¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® AI API Key"){e.innerHTML=`<p class="extra-panel-error">${t}</p>`}function et(e,t){if(!t||!t.coreVerb||!t.forms){e.innerHTML='<p class="extra-panel-empty">è¯¥è¯æ— åŠ¨è¯æ—¶æ€å˜å½¢</p>';return}const{coreVerb:a,forms:r}=t,n=[["åŸå½¢ (Base)",r.base],["è¿‡å»å¼ (Past Tense)",r.pastTense],["è¿‡å»åˆ†è¯ (Past Participle)",r.pastParticiple],["ç°åœ¨åˆ†è¯ (Present Participle)",r.presentParticiple],["ç¬¬ä¸‰äººç§°å•æ•° (3rd Person)",r.thirdPerson]].filter(([,s])=>s),o=a&&r.base&&a!==r.base?`<p class="extra-core-verb">æ ¸å¿ƒåŠ¨è¯ï¼š<strong>${y(a)}</strong></p>`:"";e.innerHTML=`
        <div class="extra-panel-content">
            ${o}
            <table class="conjugation-table">
                <tbody>
                    ${n.map(([s,i])=>`
                        <tr>
                            <td class="conj-label">${s}</td>
                            <td class="conj-value">${y(i)}</td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
        </div>
    `}function tt(e,t,a){if(!Array.isArray(t)||t.length===0){const n=a==="antonyms"?"æš‚æ— æ˜æ˜¾åä¹‰è¯":"æš‚æ— è¿‘ä¹‰è¯æ•°æ®";e.innerHTML=`<p class="extra-panel-empty">${n}</p>`;return}const r=t.map(n=>`
        <div class="extra-word-item">
            <span class="extra-word-tag" data-word="${y(n.word)}">${y(n.word)}</span>
            <span class="extra-word-explanation">${y(n.explanation||"")}</span>
        </div>
    `).join("");e.innerHTML=`<div class="extra-word-list">${r}</div>`,e.querySelectorAll(".extra-word-tag").forEach(n=>{n.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("lookupWord",{detail:n.dataset.word}))})})}function y(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function at(e){const t=new Date(e),r=new Date-t;if(r<60*1e3)return"åˆšåˆš";if(r<3600*1e3)return`${Math.floor(r/6e4)}åˆ†é’Ÿå‰`;if(r<1440*60*1e3)return`${Math.floor(r/36e5)}å°æ—¶å‰`;if(r<10080*60*1e3)return`${Math.floor(r/864e5)}å¤©å‰`;const n=t.getMonth()+1,o=t.getDate();return`${n}æœˆ${o}æ—¥`}function rt(){const e=document.createElement("div");return e.className="empty-history",e.id="emptyHistory",e.innerHTML=`
    <span class="empty-emoji">ğŸ“</span>
    <h3>è¿˜æ²¡æœ‰æ”¶å½•ä»»ä½•å•è¯</h3>
    <p>å»æŸ¥è¯é¡µé¢æœç´¢å•è¯å§ï¼</p>
  `,e}let v=[],w=0,Y=0,F=0,A=null;async function nt(){try{await x(),ot(),qe(),Ke(),await B(),console.log("VocabMaster initialized")}catch(e){console.error("Initialization error:",e),f("åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•","error")}}function ot(){const e=document.getElementById("searchInput");document.getElementById("searchBtn").addEventListener("click",()=>P()),e.addEventListener("keydown",r=>{r.key==="Enter"&&P()}),document.getElementById("retranslateBtn").addEventListener("click",ct),document.getElementById("soundBtn").addEventListener("click",()=>{const r=document.getElementById("wordTitle").textContent;if(r){const n=j(r),o=document.getElementById("soundBtn").dataset.audioUrl||null;ae(r,n==="chinese"?"zh-CN":"en-US",o)}}),document.querySelectorAll(".quick-word").forEach(r=>{r.addEventListener("click",()=>{e.value=r.dataset.word,P()})}),window.addEventListener("lookupWord",r=>{e.value=r.detail,P()}),document.querySelectorAll(".nav-btn").forEach(r=>{r.addEventListener("click",()=>{const n=r.dataset.page;n&&(q(n),n==="pageHistory"&&T(),n==="pageReview"&&V())})}),window.addEventListener("navigate",r=>{q(r.detail),r.detail==="pageReview"&&V()}),document.getElementById("flashcard").addEventListener("click",r=>{r.target.closest(".flashcard-sound-btn")||document.getElementById("flashcardInner").classList.toggle("flipped")}),document.getElementById("flashcardSoundBtn").addEventListener("click",r=>{r.stopPropagation();const n=document.getElementById("flashcardWord").textContent;if(n){const o=document.getElementById("flashcardSoundBtn").dataset.audioUrl||null;ae(n,"en-US",o)}}),document.getElementById("rememberedBtn").addEventListener("click",()=>me(!0)),document.getElementById("forgotBtn").addEventListener("click",()=>me(!1)),document.getElementById("restartReviewBtn").addEventListener("click",()=>V()),document.getElementById("historySearch").addEventListener("input",()=>T()),document.getElementById("historySort").addEventListener("change",()=>T()),document.getElementById("exportBtn").addEventListener("click",lt),document.getElementById("importBtn").addEventListener("click",()=>{document.getElementById("importFileInput").click()}),document.getElementById("importFileInput").addEventListener("change",dt),mt()}async function P(){const t=document.getElementById("searchInput").value.trim();if(t){_("loading");try{const a=j(t),r=await L(t);if(r){st(r,a),await B();return}const n=await xe(t),{dictData:o,translation:s,inputType:i}=n;if(!o){ce(i==="chinese"?"æœªèƒ½ç¿»è¯‘è¯¥ä¸­æ–‡ï¼Œè¯·å°è¯•å…¶ä»–è¡¨è¾¾":"æœªæ‰¾åˆ°è¯¥å•è¯æˆ–çŸ­è¯­ï¼Œè¯·æ£€æŸ¥æ‹¼å†™åé‡è¯•");return}const c=o.word;A=c;const d=await L(c);ie(o,s,!!d,i);const p=de();pe(c,p),document.getElementById("soundBtn").dataset.audioUrl=o.audioUrl||"",d||(await Re({word:c,phonetic:o.phonetic,audioUrl:o.audioUrl||null,meanings:o.meanings,translation:s}),f(`"${c}" å·²è‡ªåŠ¨æ”¶å½•åˆ°è¯æ±‡æœ¬`,"success"),document.getElementById("savedIndicator").classList.remove("hidden")),await B()}catch(a){console.error("Search error:",a),ce("æŸ¥è¯¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•")}}}function st(e,t){A=e.word;const a={word:e.word,phonetic:e.phonetic||"",audioUrl:e.audioUrl||null,meanings:e.meanings||[],source:e.meanings&&e.meanings.length>0?null:"translation-only"};ie(a,e.translation,!0,t),document.getElementById("soundBtn").dataset.audioUrl=a.audioUrl||"";const r=de();pe(e.word,r)}function pe(e,t){for(const[a,{panel:r,header:n,body:o}]of Object.entries(t))n.addEventListener("click",()=>{r.classList.toggle("expanded")&&o.dataset.status!=="loaded"&&it(e,a,o)})}async function it(e,t,a){if(a.dataset.status==="loading"||a.dataset.status==="loaded")return;a.dataset.status="loading",Qe(a);const r=`${t}Data`,n=await L(e),o=n==null?void 0:n[r];if(o!=null){ge(t,a,o),a.dataset.status="loaded";return}const s=await Se(e,t);if(s!==null)await U(e,{[r]:s}),ge(t,a,s),a.dataset.status="loaded";else{const c=localStorage.getItem("llm-api-key")?"æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•":"è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® AI API Key";Ze(a,c),a.dataset.status="error"}}function ge(e,t,a){e==="conjugations"?et(t,a):tt(t,a,e)}async function ct(){if(!localStorage.getItem("llm-api-key")){f("è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® AI API Key","info");return}const t=document.getElementById("searchInput").value.trim();if(!t)return;const a=document.getElementById("retranslateBtn"),r=a.querySelector("span"),n=r.textContent;a.disabled=!0,a.classList.add("loading"),r.textContent="ç¿»è¯‘ä¸­...";try{const o=await $(t);if(o){document.getElementById("translationContent").textContent=o,A&&await L(A)&&await U(A,{translation:o});const i=(localStorage.getItem("llm-provider")||"deepseek")==="gemini"?"Gemini":"DeepSeek";f(`å·²ä½¿ç”¨ ${i} AI é‡æ–°ç¿»è¯‘`,"success")}else f("AI ç¿»è¯‘å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆ","error")}catch(o){console.error("Retranslate error:",o),f("ç¿»è¯‘å¤±è´¥ï¼Œè¯·é‡è¯•","error")}finally{a.disabled=!1,a.classList.remove("loading"),r.textContent=n}}async function T(){try{let e=await C();const t=await He();Ye(t);const a=document.getElementById("historySearch").value.trim().toLowerCase();switch(a&&(e=e.filter(n=>n.word.includes(a)||n.translation&&n.translation.includes(a))),document.getElementById("historySort").value){case"newest":e.sort((n,o)=>o.addedAt-n.addedAt);break;case"oldest":e.sort((n,o)=>n.addedAt-o.addedAt);break;case"alpha":e.sort((n,o)=>n.word.localeCompare(o.word));break;case"level":e.sort((n,o)=>o.level-n.level);break}Fe(e,async n=>{await Ne(n),f(`"${n}" å·²ä»è¯æ±‡æœ¬åˆ é™¤`,"info"),await B(),await T()},n=>{document.getElementById("searchInput").value=n,q("pageDictionary"),P()})}catch(e){console.error("History refresh error:",e)}}async function V(){try{const e=await ne();if(e.length===0){K("noReview");const t=await Ue();Ge(t);return}v=gt([...e]),w=0,Y=0,F=0,K("card"),le(v[0],1,v.length),document.getElementById("flashcardSoundBtn").dataset.audioUrl=v[0].audioUrl||""}catch(e){console.error("Review refresh error:",e)}}async function me(e){if(w>=v.length)return;const t=v[w];if(e?Y++:F++,await De(t.word,e),w++,w>=v.length){Ve(Y,F),await B();return}le(v[w],w+1,v.length),document.getElementById("flashcardSoundBtn").dataset.audioUrl=v[w].audioUrl||""}async function B(){try{const e=await je(),t=await oe();Je(e,t)}catch(e){console.error("Stats refresh error:",e)}}async function lt(){try{const e=await Me();f(`æˆåŠŸå¯¼å‡º ${e} ä¸ªè¯æ±‡`,"success")}catch(e){console.error("Export error:",e),f(e.message||"å¯¼å‡ºå¤±è´¥","error")}}async function dt(e){const t=e.target.files[0];if(t){try{const{imported:a,skipped:r}=await We(t);let n=`æˆåŠŸå¯¼å…¥ ${a} ä¸ªè¯æ±‡`;r>0&&(n+=`ï¼Œè·³è¿‡ ${r} ä¸ªå·²å­˜åœ¨è¯æ±‡`),f(n,"success"),await T(),await B(),pt()}catch(a){console.error("Import error:",a),f(a.message||"å¯¼å…¥å¤±è´¥","error")}e.target.value=""}}function pt(){window.electronAPI&&window.electronAPI.dataChanged&&window.electronAPI.dataChanged()}function gt(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}document.addEventListener("DOMContentLoaded",nt);const G={deepseek:{placeholder:"sk-...",linkUrl:"https://platform.deepseek.com/api_keys",linkText:"platform.deepseek.com"},gemini:{placeholder:"AIza...",linkUrl:"https://aistudio.google.com/apikey",linkText:"aistudio.google.com"}};function mt(){const e=document.getElementById("settingsNavBtn"),t=document.getElementById("settingsOverlay"),a=document.getElementById("settingsCloseBtn"),r=document.getElementById("deepseekApiKey"),n=document.getElementById("toggleApiKeyVisibility"),o=document.getElementById("testApiKeyBtn"),s=document.getElementById("saveApiKeyBtn"),i=document.getElementById("apiKeyStatus"),c=document.getElementById("apiKeyLink");document.getElementById("apiKeyHint");const d=document.getElementById("llmProvider");function p(l){const g=G[l]||G.deepseek;r.placeholder=g.placeholder,c.href=g.linkUrl,c.textContent=g.linkText;const u=localStorage.getItem("llm-api-key")||"",b=localStorage.getItem("llm-provider")||"deepseek";r.value=b===l?u:""}d.addEventListener("change",()=>{p(d.value),i.classList.add("hidden")}),e.addEventListener("click",()=>{const l=localStorage.getItem("llm-provider")||"deepseek";d.value=l,p(l),i.classList.add("hidden"),t.classList.remove("hidden")}),a.addEventListener("click",()=>t.classList.add("hidden")),t.addEventListener("click",l=>{l.target===t&&t.classList.add("hidden")}),n.addEventListener("click",()=>{r.type=r.type==="password"?"text":"password"}),s.addEventListener("click",()=>{var u;const l=r.value.trim(),g=d.value;localStorage.setItem("llm-provider",g),l?(localStorage.setItem("llm-api-key",l),f(`${((u=G[g])==null?void 0:u.linkText)||g} API Key å·²ä¿å­˜`,"success")):(localStorage.removeItem("llm-api-key"),f("API Key å·²æ¸…é™¤","info")),t.classList.add("hidden")}),o.addEventListener("click",async()=>{const l=r.value.trim();if(!l){i.textContent="è¯·å…ˆè¾“å…¥ API Key",i.className="api-key-status error";return}o.disabled=!0,o.textContent="æµ‹è¯•ä¸­...",i.classList.add("hidden");const g=d.value,u=await Ee(l,g);i.textContent=u.message,i.className=`api-key-status ${u.success?"success":"error"}`,o.disabled=!1,o.textContent="æµ‹è¯•è¿æ¥"}),c.addEventListener("click",l=>{l.preventDefault();const g=c.href;window.electronAPI&&window.electronAPI.openExternal?window.electronAPI.openExternal(g):window.open(g,"_blank")})}})();
